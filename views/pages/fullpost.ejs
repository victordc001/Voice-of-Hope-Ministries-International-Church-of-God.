 

<!DOCTYPE html>
<html>
    <head>
   
      <%- include('../partials/head.ejs') %> 
      <title>Post</title> 


      <style>  
                       
          .conf{
                     background-color:white;
                     margin-top:15px; 
                     width:100%; 
                     padding-top:0px;  
                     padding-bottom:5px; 
                     padding-left:20px;
                     padding-right:20px;  
                     animation-name:disp;
                     animation-duration:1.5s;
                     animation-iteration-count:1; 
                     border-top-left-radius:7px;
                     border-top-right-radius:7px;
                     border-bottom-left-radius:7px;
                     border-bottom-right-radius:7px;  
                  }    

                   .conf:hover{ 
                      border:2px solid white;
                   }


                

                   @keyframes disp{
                       
                    from{
                         margin-top:-300px;
                    }  

                     to{
                       margin-left:0px;
                     }

                   }

                   video{ 
                     border-top-left-radius:7px;
                     border-top-right-radius:7px;  
                   }   

                      .conf .title{  
                        font-family: "Poppins", sans-serif;
                        font-size:16.5px;  
                        padding-top:15px;
                        font-weight:bold;
                      }  

                      .conf .verse, .conf .author, .conf .date{ 
                        color:grey; 
                        padding-top:5px;  
                        font-family: "Poppins", sans-serif;
                        font-size:16px; 
                      }   
                 
                      .pbody{ 
                        color:grey;  
                        padding-top:5px;
                        font-family: "Poppins", sans-serif;
                        font-size:16.5px; 
                      }     


                      #nocomment{ 
                        color:#3090c6;
                        padding-top:5px;
                        margin-top:7px;
                        margin-bottom:7px;
                        font-family: "Poppins", sans-serif;
                        font-size:16px; 
                        font-weight:bold;
                      }  
  
                      .encloseconf{
                            background-color:#fff;   
                            padding-top:45px;
                            padding-bottom:25px;  
                            margin-left:40px;
                            margin-right:40px;
                            padding-left:40px;
                            padding-right:40px; 
                            min-width:100px;    
                          }   

 


                     .commentenc{
                      min-width:100px;  
                       padding-bottom:40px;
                     }
                      


                   .comment textarea{
                          background:none;
                          color:black;
                          width:100%;
                          border:2px solid grey;
                          border-radius:5px; 
                          padding-top:12px;
                          padding-bottom:12px;
                          padding-left:10px;
                          padding-right:10px; 
                          height:140px;
                          margin-top:10px;

                       }      

                     .commentb button{ 
                      background-color:#3090c6;
                      color:#fff;
                      font-weight:bold;
                      font-size:15px; 
                      letter-spacing:1px;
                      font-family:Arial;
                      width:90px; 
                      margin-top:10px; 
                      border:none;
                      padding:7px;
                   }   

                   .commentb button:hover{
                    font-size:16px;
                   }
                              

                   h1{ 
                     text-align:left; 
                     color:#212121;
                     font-weight:bold;
                      font-size:16.5px;
                      font-family:'Poppins', sans-serif;
                      margin-top:50px;
                     } 

                     h2{ 
                     text-align:left; 
                     color:#212121;
                      font-size:16.5px;
                      font-family:'Poppins', sans-serif;
                      margin-top:50px;
                     } 



 

.comments-container {
    max-width: 600px;
    margin: 20px auto; 
    max-height:400px;
    position:relative;
    overflow:scroll;
}

.acomment {
    background-color: #fff;
    border: 1px solid #ddd;
    border-radius: 8px;
    margin-bottom: 15px;
    position:relative;
    padding-left:20px;
    padding-right:20px;
    padding-top:25px;
    padding-bottom:14px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.user p, .text p{ 
    font-family:'Poppins', sans-serif;
    margin-bottom: 10px;
    font-size:15px;
    margin-left:15px;
    color:grey; 
}  

 .user p strong{
  color:#3090c6;
 }     

 .user p span, .text p span{
  color:black;
  font-weight:bold;
 }   

 .text p strong{
  color:crimson;
 }    

 .sectiona img  {
    width:100%;
    height:270px;
 }

   .reply:hover{ 
     height:20px;
     padding-top:4px;
     padding-bottom:20px; 
     font-size:14px;
   }    
 
   .repcon input, .repcon button{ 
        margin-left:20px;
        border-radius:5px;
        cursor:pointer;
   } 

   .repcon{  
    display:flex;  
    margin-top:25px;
    padding-right:10px;
       justify-content:space-between;  
       left:0; 
       right:0;
       width:100%; 
       animation-name:reply;
      animation-duration:1.5s;
      animation-iteration-count:1; 
       background-color:white;
       
   }  

   .repcon input{
    border:none;
    background-color:none;
    width:60%;
    background-color:white;
     box-shadow : 0px 2px 4px 0px rgba(0,0,0.2); 
    outline:none;
    padding:12px;
   } 
 
   .repcon i{
    font-size:25px;
    color:crimson;
    margin-left:40px;
    margin-top:13px;
    font-weight:bold;  
   }     

   .repcon button{
            background:none;
            border:none;
   } 


   @keyframes reply{
       from{
          margin-bottom:-300px;
       } 

       to{
          margin-bottom:0px;
       }
   } 



   /* related posts */
   
    
   .related-posts {
  min-width:100px;  
  padding-left:40px;
  padding-right:40px;
  padding-top:30px;
  padding-bottom:20px;
  margin-left:40px;
  margin-right:40px;
  margin-top:10px;
  background-color: #fff; 
  border-radius: 8px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
} 

  

          h3{ 
                     text-align:left; 
                     color:#212121;
                      font-size:16px;
                      margin-left:40px;
                      font-family:'Poppins', sans-serif;
                      margin-top:24px;
                     } 


.post-card {
  margin-bottom: 20px;
  padding: 15px;
  background-color: #fff;
  border-radius: 8px; 
  display:flex; 
  width:100%;
  justify-content:space-between;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.post-card img{
  width:100%; 
  height:auto;
  margin-top:10px;
  border-radius:7px;
  border-radius: 4px;
}

.post-card .pt{
  font-size:19px;
  font-family:'Poppins', sans-serif;
  margin-top: 90px;
}

.post-card p {
  color: #555; 
  font-size:14px; 
  font-family:'Poppins', sans-serif;
  margin-bottom:7px;
}

.read-more {
  display: inline-block;
  padding:9px;
  border:none;
  font-weight:bold;
  font-family:'Poppins', sans-serif;
  background-color:#3090c6;
  color: #fff;
  text-decoration: none; 
  width:150px;
  transition: background-color 0.3s;
}

.read-more:hover {
  background-color: #2980b9;
}
    

  .access{ 
    display:flex; 
    justify-content:right;
    padding-left:20px;
    padding-right:20px;
    padding-top:20px;
    padding-bottom:20px;  
    background-color:white;
  }  


  .access button{ 
                      background-color:#3090c6;
                      color:#fff;
                      font-weight:bold;
                      font-size:15px; 
                      letter-spacing:1px;
                      font-family:Arial;
                      width:170px; 
                      margin-right:10px;
                      margin-top:10px; 
                      border:none;
                      padding:7.5px;
                   }   



                   @media only screen and (max-width:490px) {
                    .post-card img{
                      width:100px; 
                      margin-left:12px;
                    }  
                    .post-card{
                      display:block;
                    } 

                    .post-card .pt{
                      margin-top:5px; 
                    }
                         .post-card p{
                              text-align:left;
                         }

                    }
  
    
                  

         @media only screen and (max-width:889px) {
                        .encloseconf{   
                            margin-left:20px;
                            margin-right:20px;
                            padding-left:10px;
                            padding-right:10px;    
                          }   

                          .conf{
                            padding-left:10px;
                            padding-right:10px;
                          }
                        }



                     @media only screen and (min-width:890px) {

                        .encloseconf{
                      display:flex;
                      justify-content:space-between; 
                     }    

                     .related-posts{ 
                         display:flex;
                        justify-content:space-between;
                        overflow:scroll;
                     }  

                      .post-card{
                        margin-right:20px;
                      }

                     .sectiona, .sectionb{
                      width:100%;
                      padding-left:20px;
                      padding-right:20px;
                     }

                     .comment textarea{
                      width:100%; 
                     }

                    }
 
      </style>
   
    
    </head>

     <body>    
      
         <%- include('../partials/navbar.ejs') %>    <br><br>  <br><br>
         
         <% if(user && user.role === 'admin') { %>
          <div class='access' data-postId = 'ok'>
 
         <a href =' <%= `/admin-control-edit-6gv119jsbv532g5d892c4b83/${post._id}` %>'> 
             <button id="startedit">
           <i class='fa fa-pencil'></i>Start Editing
         </button>
         </a>  
              
        
           <button id="deleting" postid="<%= post._id %>">
         <i class='fa fa-trash'></i>Delete Post
       </button>
     
 
          </div>  
       <% } %> 
     
        
  
         <div class="encloseconf">  
      
      <div class="sectiona">
          <img src="/<%= post.postImage.path %>" alt="blogpost">


         <div class="conf">    
               <p class="title"><%= post.posttitle %></p>  
             <p class="pbody"> <%= post.postbody%> </p>  <br><br>
 
             <p class="verse"> <strong>Bible verse:</strong>  <%= post.bibleverse %>  </p>
             <p class="author"> <strong>Author:</strong> <%= post.author %> </p> 
              

             <% const posteddate = new Date(post.date)%>
             <% const year = posteddate.getFullYear(); %>
             <% const month = posteddate.toLocaleString('en-US', {month : 'long' }) %>
             <% const day = post.date.getDate(); %>
             <p class="date"> <strong>Date:</strong> <%= month + '-' + day + ' ' + year %> </p>
              
       </div>  
    </div>

   <div class="sectionb">
        <!-----comment section----->  
      <h1>comments</h1>
        <div class="comments-container">  
          <!----Display top level comments-->  
        <%  const toplevelcomments = comments.filter(comment => comment.parentComment === null); %>
        <% if (toplevelcomments.length > 0) { %>
        <% toplevelcomments.forEach(mycomment =>{ %> 
            <div class="acomment"> 

              <div class="user"> 
                <p> <strong>Author</strong> <span>:</span> <%= mycomment.user.reguser %></p>
                </div> 

                <div class="text"> 
                  <p> <strong>comment</strong> <span>:</span> <%= mycomment.txtbodyy %></p>
                  </div>        

                  </div> 

         <% }); %> 

               <% } else { %>
                    <p id="nocomment">No comments yet</p>
               <% } %>

         

         


      </div>


         <h2>Leave a comment</h2>
            <div class="commentenc">
          
      
      <form id="commentt" data-id = <%= post._id %>> 

        <div class="comment">  
            <textarea id="txtbody" placeholder="Body" required> </textarea>
           <p id="errcomment"></p> 
         </div>   


      
           <div class="commentb">
            <button id="mtbut">Post</button>
           </div>  
 

          </form> 

      </div> 

   </div>

          </div> 

         
          <!--Related posts-->

          <h3 class="relpo">Related Posts</h3>

          <section class="related-posts">  
 
          <% relatedposts.forEach(relpost=>{ %>
            <div class="post-card"> 
              <div style="width:100%">
              <img src="/<%= relpost.postImage.path %>" alt="relatedposts" >
              </div> 
              <div style="width:100%; padding-left:20px; padding-right:20px;">
              <p class="pt"><%= relpost.posttitle %></p>
              <p><%= relpost.postbody.length > 180 ? `${relpost.postbody.substring(0, 80)}...` : relpost.postbody %></p>
              <a href='<%= `/blogposts/${relpost._id}` %>'><button class="read-more">Read More</button></a>
              </div> 
            </div>    
            
        <% }); %>
      
        
          </section>
        
         

          <%- include('../partials/footer.ejs') %>   

          <script>  


             //post top level comments
             var commentForm = document.getElementById('commentt');
            commentForm.addEventListener('submit', async (cmt)=>{
    
                  cmt.preventDefault();  
                const  mtbut = document.getElementById('mtbut');  
                  const txtbody = document.getElementById('txtbody'); 
                const  errcomment = document.getElementById('errcomment'); 
                  const data = {
                   txtbodyy : txtbody.value
                  }  
              const idpost = commentForm.dataset.id; 
              if(txtbody.value.trim() == ''){  
                errcomment.innerHTML = 'Comment box cannot be empty';   
                  errcomment.style.color = 'red';
                   errcomment.style.marginTop = '10px';
                   errcomment.style.fontSize = '16px';
                   errcomment.style.fontWeight = 'bold';
                   errcomment.style.fontFamily = 'helvetica';  
              }  

              else{   
                mtbut.style.opacity = '0.5';
                mtbut.innerHTML = 'Posting';
              try{
             const response = await fetch(`/comment/${idpost}`, {
                        method : 'post',
                        body : JSON.stringify(data),
                        headers : {
                         'Content-Type' : 'application/json',
                           Accept : 'application/json',
                        },
             }); 
                  
              
             mtbut.innerHTML = 'posted'; 
             mtbut.style.opacity = '1';

             setInterval( ()=>{
             window.location.reload();  
             }, 2000);

             if(!response.ok){ 
                        throw response;
                    }  
                    errcomment.innerHTML = '';  
              }  

              catch(err){
                const result = await err.text();  
                mtbut.innerHTML = 'Posting fail';
                mtbut.style.opacity = '1';
                  errcomment.innerHTML = result;
                   errcomment.style.color = 'red';
                   errcomment.style.marginTop = '10px';
                   errcomment.style.fontSize = '16px';
                   errcomment.style.fontWeight = 'bold';
                   errcomment.style.fontFamily = 'helvetica'; 
              }
            }

            });   
 
      
 
      var deleting = document.getElementById('deleting');  

            deleting.onclick = async (e)=>{   

              try{
                // Ask for confirmation
           const confirmed = window.confirm("Are you sure you want to delete this post?");
        if (confirmed) {
              const postid = e.target.getAttribute('postid');
              e.target.innerHTML = 'Deleting'; 
             const deleteresponse = await fetch(`/admin-control-delete-bc7893387249jn/${postid}`, {
                        method : 'delete', 
             });  


             setTimeout(()=>{
              e.target.innerHTML = 'Deleted';
             e.target.style.backgroundColor = 'green';
            },1000);

             setTimeout(()=>{
             window.location.href = '/blogposts';
            },4000);

           }   

           else {
            // If not confirmed, do nothing
            return false;
        }
      }

           catch(err){
              alert(err);
           }

           }; 
     
             

                    var newreply = document.getElementById('newreply');
            newreply.addEventListener('submit', async (re)=>{
                  re.preventDefault();   
                  const repinp = document.getElementById('repinp'); 
                const  errep = document.getElementById('errep'); 
                  const datab = {
                   repinpp : repinp.value,
                  }  
              const idpostt = newreply.dataset.postid; 
              const idcomment = newreply.dataset.commentid; 

              if(repinp.value.trim() == ''){  
                errep.innerHTML = 'Reply box cannot be empty'; 
                  errep.style.color = 'red';
                   errep.style.marginTop = '10px';
                   errep.style.marginLeft = '10px';
                   errep.style.fontSize = '14.7px';
                   errep.style.fontWeight = 'bold';
                   errep.style.fontFamily = 'helvetica';  
              }  

              else{    
              try{
             const response = await fetch(`/reply/${idpostt}/${idcomment}`, {
                        method : 'post',
                        body : JSON.stringify(datab),
                        headers : {
                         'Content-Type' : 'application/json',
                           Accept : 'application/json',
                        },
             }); 
                   
                 errep.innerHTML = 'Posted'; 
                  errep.style.color = 'green';
                   errep.style.marginTop = '20px';
                   errep.style.marginLeft = '10px';
                   errep.style.fontSize = '14.7px';
                   errep.style.fontWeight = 'bold';
                   errep.style.fontFamily = 'helvetica'; 
                   setInterval( ()=>{
             window.location.reload();  
             }, 2000);  
             
             if(!response.ok){ 
                        throw response;
                    }   
              }   


              

              catch(err){
                const result = await err.text();   
                  errep.innerHTML = result;  
                  errep.style.color = 'red';
                  errep.style.marginLeft = '10px';
                   errep.style.marginTop = '10px';
                   errep.style.fontSize = '14.7px';
                   errep.style.fontWeight = 'bold';
                   errep.style.fontFamily = 'helvetica'; 
              }
            }

            });   
  

          </script>

 

     </body>

</html> 
 