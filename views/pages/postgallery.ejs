
  

<!DOCTYPE html>
<html>
  <head>  
    <%- include('../partials/head.ejs') %> 
    <title>Publish a post</title>     
    <style>
          .postcontentb{
                      background-color:white; 
                      margin-left:20px;
                      min-width:100px; 
                      margin-right:20px;  
                     animation-name:bganimateb;
                    animation-duration:0.9s;
                     animation-iteration-count:1;
                      margin-top:25px;
                      text-align:center;
                        padding-left:10px;
                        padding-right:10px;
                        padding-top:40px;
                        padding-bottom:40px; 
                      }   

                      
                      @keyframes bganimateb{
                         
                         from{
                            margin-right:300px;
                         } 
                          
                         to{
                           margin-left:0px;
                         }
 
                        }   
                         

                        input{
                             width:100%;
                        }
    </style>
  </head>  
  <body> 
    <!---Navigation starts--->
    <div class="enclose">
        <%- include('../partials/navbar.ejs') %>

        <!----Homebar start-->
        <div class="homebar">
            <p class='big'>ADMIN CONTROL</p>
            <p class="small">Publish a post here (gallery)</p>
            <div style='display:flex'> <a href='/'>Go Home</a> <i class="fa fa-long-arrow-right"></i> </div>
        </div>
        <!----Homebar end-->
    </div>
    <!---Navigation ends---> 
  
       <div class="postcontentb">    
          <p class="bigg">ADD TO GALLERY</p>  
             <form id="postar" enctype="multipart/form-data">     
              <input type="file" id='galeri'  name='postgallery' multiple required>
              <button class="postbut">Add to Gallery</button>  
              </form>        
     </div>      
   
    
   <%- include('../partials/footer.ejs') %>
  
      <script> 
   
   
                postar.addEventListener('submit', async (event)=>{
                  const pb = document.querySelector('.postbut'); 
                          event.preventDefault();  
                       pb.innerHTML = 'POSTING...';
                       pb.style.opacity = '0.855'; 
                  const admfiles = document.getElementById('galeri').files; 
                  const data = new FormData();  

                  for (let i = 0; i < admfiles.length; i++) {
                         data.append('postgallery', admfiles[i]);
                      }
                 
  
                        try{
   
                  const resp = await fetch('/postinggallery', { 
                       method :'post',
                       body : data,   
                  }); 
                  
                 if(!resp.ok){
                    throw resp; 
                 }   
  
                    const posted = document.getElementById('posted');
                    pb.style.opacity = '1'; 
                 setTimeout( ()=>{  
                 pb.innerHTML = 'POSTED';
                 }, 4000);
  
                 setTimeout( ()=>{ 
                 location.reload();
                 }, 6000);
              }
            
  
                  catch(err){
                    console.log(err);
                    const error = await err.text();
                    alert(error);
                    location.reload();
                  }    
                 
                });    
  
   
          </script> 
          </body>
          </html>
  
      